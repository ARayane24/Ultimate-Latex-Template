% =============================================
%  PACKAGE LOADING & LOGIC
% =============================================

% --- Layout & Geometry ---
% Load geometry package with custom margins
\usepackage[a4paper,
            top=\TopMargin,
            bottom=\BottomMargin,
            left=\LeftMargin,
            right=\RightMargin]{geometry}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\small \textbf{\DocTitle}}
\fancyhead[R]{\small \leftmark}
\fancyfoot[C]{\thepage}


% --- Spacing & Typography ---
\usepackage{setspace}
\onehalfspacing
\setlength{\parindent}{\ParIndent}
\setlength{\parskip}{\ParSkip}
\usepackage{microtype}

% --- Colors & Graphics ---
\usepackage{xcolor}
\definecolor{PrimaryColor}{HTML}{\ThemeColor}
\usepackage{wrapfig}
\usepackage{graphicx}
\graphicspath{{figures/}}

% --- Links ---
\usepackage[hidelinks]{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=PrimaryColor,
    urlcolor=PrimaryColor,
    citecolor=PrimaryColor,
    pdftitle={\DocTitle},
    % Clean up author list for PDF metadata (remove \\)
    pdfauthor={Multiple Authors}
}

% --- Tables & Lists ---
\usepackage{array}
\usepackage{booktabs}
\usepackage{enumitem}
\setlist{nosep} % Compact lists

% --- Tools (MUST LOAD BEFORE BIDI/POLYGLOSSIA) ---
\usepackage{listings}
\usepackage{tcolorbox}

% --- Language & Fonts (The Heavy Lifting) ---
\usepackage{fontspec}

\ifRTLmode
    % RTL Setup (Arabic/Hebrew)
    % LuaLaTeX handles RTL via Babel or Polyglossia beautifully
    \usepackage{polyglossia}
    \setmainlanguage{\MainLanguage}
    \setotherlanguage{\SecondLanguage}
    \newfontfamily\arabicfont[Script=Arabic]{\ArabicFont}
    \setmainfont{\MainFont}
\else
    % LTR Setup (English/French)
    \usepackage{polyglossia}
    \setmainlanguage{\MainLanguage}
    \setotherlanguage{\SecondLanguage}
    \setmainfont{\MainFont}
    \setmonofont{\MonoFont}
    % Define Arabic font just in case we mix languages
    \newfontfamily\arabicfont[Script=Arabic]{\ArabicFont}
\fi

\usepackage{ulem}     % for underlining
\usepackage{caption}  % for customizing captions
\usepackage{xparse} % For flexible argument handling
\usepackage{expl3}
\usepackage{comment} % For block comments
\usepackage{background} % For watermarking
% --- Custom Command Definitions ---
\input{structure/macros.tex}
